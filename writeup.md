---
title: "SQL-Injection in Evasys Logbuch - TODO"
date: 2023-04-24T14:33:43Z
draft: false
toc: false
images:
tags:
  - SQL-Injection
  - database
---
<!-- These are required fields for the disclosure process -->
**Affected Product:** Evasys 

**Affected Versions:**  evasys v8.2 Build 2275 - 2285 and evasys v9.0 Build 2400 (both according to vendor)
 

**Fixed Version:** v8.2 Build 2286 and v9.0 Build 2401 

**CVE-Number:** TODO 

**Severity:** 9.1 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:L/A:L)
<!-- Add your names. -->
*Discovered by Dipl-Ing. Mario Rubak, BSc MSc and Regina Kohl, BSc*

<!-- Brief introduction. -->
During a penetration test for a customer, the penetration testers identified that the webapplication evasys allows the user to inject SQL-Code into the "welche" parameter.
The vulnerability lies with the component "Logbuch", which can be accessed by authenticated users.

## Proof of Concept
<!-- In Depth discussion of the vulnerability. Whats it's impact, show enough proof but not too much. DO NOT INCLUDE EXPLOIT PAYLOADS! -->
In this particular case, three different techniques (boolean-based blind, stacked queries, and UNION queries) were identified to exploit the SQL injection vulnerability. The feasibility is demonstrated using a UNION query injection. A UNION injection with 9 columns was identified, which means that in the following proof-of-concept (PoC) request, NULL was concatenated 9 times, once for each column. This request returns a positive HTTP 200 status message, and an empty row is displayed in the web application.
```
POST /project/SearchProject/ HTTP/1.1 
<Header shortend>

welche=welche=0) UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL-- LDqO&maxrow=15&posi=0

--> HTTP/1.1 200 OK

```
![PoC UNION-Injection in Webapplication](../images/SQLi_1)

However, if you concatenate only 8 or fewer, or 10 or more NULL expressions, the web server returns error code 500:
```
POST /project/SearchProject/ HTTP/1.1 
<Header shortend>

welche=welche=0) UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL -- LDqO&maxrow=15&posi=0

--> HTTP/1.1 500 Internal Server Error
```

This makes it possible to inject specific SQL statements instead of a NULL expression, and thus execute queries that are displayed in the web application:
![Reading all tables of the evasys database](../images/SQLi_2)
![Existing tables in the database 'evasys' (excerpt)](../images/SQLi_3)
![Column 'username' and 'password' in the 'benutzer' table of the 'evasys' database (excerpt)](../images/SQLi_4)


## Vendor contact timeline 
<!-- Fill in your contact timeline!-->
| Date       | Action                                                                                                                                                                             |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 2022/07/26    | Discovery of the vulnerability    |
| 2023/08/05    | Bulk disclosure of multiple vulnerabilities using the vendors support mail    |
| 2023/08/08    | Vendors respond that they acknowledge the findings and start to work on a fix    |
| 2023/08/10    | Evasys shares detailed plan for the fix with the researchers and asks for a few months of time before disclosing the vulnerability    |
| 2023/08/23    | Vendor responds that the vulnerabilities will be fixed in version 8.2 and 9.0 in 2023/09/06  |
| 2023/01/02    | First attempt to request CVEs at MITRE  |
| 2023/03/23    | Request was closed by MITRE without stating a reason  |
| 2023/04/24    | Second attempt to request CVEs at MITRE   |
| 2023/03/02    | MITRE assigns  TODO |
| 2023/TODO/TODO    | TODO  |
| 2023/TODO/TODO    | TODO  |
| 2023/TODO/TODO    | TODO  |

